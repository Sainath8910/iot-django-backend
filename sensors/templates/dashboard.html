<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Monitoring Dashboard</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&family=Noto+Sans:wght@400;500;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
tailwind.config = {
  darkMode: "class",
  theme: {
    extend: {
      colors: {
        primary: "#49e619",
        "background-dark": "#152111",
        "card-dark": "#1a2c15",
        "border-dark": "#2c4724",
        "text-secondary": "#9fc893"
      },
      fontFamily: {
        display: ["Manrope"],
        body: ["Noto Sans"]
      }
    }
  }
}
</script>

<style>
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-thumb { background: #2c4724; border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #49e619; }
</style>
</head>

<body class="bg-background-dark text-white font-display overflow-hidden">

<div class="flex h-screen">

<!-- ================= SIDEBAR ================= -->
<aside class="w-20 lg:w-64 bg-background-dark border-r border-border-dark flex flex-col">
  <div class="h-20 flex items-center justify-center lg:px-6 border-b border-border-dark">
    <div class="flex items-center gap-3">
      <div class="size-8 rounded-full bg-primary/20 flex items-center justify-center text-primary">
        <span class="material-symbols-outlined">eco</span>
      </div>
      <span class="hidden lg:block font-bold">EcoMonitor</span>
    </div>
  </div>
</aside>

<!-- ================= MAIN ================= -->
<main class="flex-1 flex flex-col">

<header class="h-20 border-b border-border-dark bg-background-dark flex items-center justify-between px-6">
  <div>
    <h1 class="text-xl font-bold">Live Monitoring</h1>
    <p class="text-sm text-text-secondary">Greenhouse Unit A-42</p>
  </div>
</header>

<div class="flex-1 overflow-y-auto p-6 space-y-8">

<!-- ================= KPI CARDS ================= -->
<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">

<div class="bg-card-dark border border-border-dark rounded-xl p-6">
  <p class="text-text-secondary flex gap-1">
    <span class="material-symbols-outlined">thermostat</span> Temperature
  </p>
  <h3 id="tempValue" class="text-3xl font-bold mt-2">--°C</h3>
  <canvas id="tempChart" class="h-24 mt-4"></canvas>
</div>

<div class="bg-card-dark border border-border-dark rounded-xl p-6">
  <p class="text-text-secondary flex gap-1">
    <span class="material-symbols-outlined">water_drop</span> Humidity
  </p>
  <h3 id="humidValue" class="text-3xl font-bold mt-2">--%</h3>
  <canvas id="humidChart" class="h-24 mt-4"></canvas>
</div>

<div class="bg-card-dark border border-border-dark rounded-xl p-6">
  <p class="text-text-secondary flex gap-1">
    <span class="material-symbols-outlined">potted_plant</span> Soil Moisture
  </p>
  <h3 id="soilValue" class="text-3xl font-bold mt-2">--%</h3>
  <canvas id="soilChart" class="h-24 mt-4"></canvas>
</div>

<div class="bg-card-dark border border-border-dark rounded-xl p-6">
  <p class="text-text-secondary flex gap-1">
    <span class="material-symbols-outlined">science</span> pH Level
  </p>
  <h3 id="phValue" class="text-3xl font-bold mt-2">--</h3>
  <canvas id="phChart" class="h-24 mt-4"></canvas>
</div>

</div>

<!-- ================= TABLE ================= -->
<div class="bg-card-dark border border-border-dark rounded-xl overflow-hidden">
<table class="w-full text-center">
<thead class="bg-[#1e3419]">
<tr>
  <th class="p-4 text-xs text-text-secondary">Time</th>
  <th class="p-4 text-xs text-text-secondary">Temp</th>
  <th class="p-4 text-xs text-text-secondary">Humidity</th>
  <th class="p-4 text-xs text-text-secondary">Soil</th>
  <th class="p-4 text-xs text-text-secondary">pH</th>
  <th class="p-4 text-xs text-text-secondary">Status</th>
</tr>
</thead>
<tbody id="tableBody" class="divide-y divide-border-dark text-sm"></tbody>
</table>
</div>

</div>
</main>
</div>

<!-- ================= SCRIPT ================= -->
<script>
let tempChart, humidChart, soilChart, phChart;

function createChart(id) {
  return new Chart(document.getElementById(id), {
    type: 'line',
    data: { labels: [], datasets: [{ data: [], borderWidth: 2, tension: 0.4 }] },
    options: {
      plugins: { legend: { display: false } },
      scales: { x: { display: false }, y: { display: false } }
    }
  });
}

tempChart = createChart("tempChart");
humidChart = createChart("humidChart");
soilChart = createChart("soilChart");
phChart = createChart("phChart");

function updateDashboard() {
  fetch("/latest/")
    .then(res => res.json())
    .then(data => {
      let labels=[], t=[], h=[], s=[], p=[], rows="";

      data.forEach(r => {
        labels.push(r.time);
        t.push(r.temperature);
        h.push(r.humidity);
        s.push(r.soil);
        p.push(r.ph);

        rows += `
        <tr class="hover:bg-white/5">
          <td class="p-4">${r.time}</td>
          <td class="p-4">${r.temperature}°C</td>
          <td class="p-4">${r.humidity}%</td>
          <td class="p-4 ${r.alert ? 'text-red-400 font-bold':''}">${r.soil}%</td>
          <td class="p-4">${r.ph}</td>
          <td class="p-4">
            <span class="px-3 py-1 rounded-full text-xs font-bold ${
              r.alert ? 'bg-red-500/20 text-red-500' : 'bg-primary/20 text-primary'
            }">
              ${r.alert ? 'ALERT' : 'NORMAL'}
            </span>
          </td>
        </tr>`;
      });

      tableBody.innerHTML = rows;

      const last = data[data.length - 1];
      tempValue.textContent = last.temperature + "°C";
      humidValue.textContent = last.humidity + "%";
      soilValue.textContent = last.soil + "%";
      phValue.textContent = last.ph;

      [tempChart, humidChart, soilChart, phChart].forEach((c, i) => {
        c.data.labels = labels;
        c.data.datasets[0].data = [t, h, s, p][i];
        c.update();
      });
    });
}

setInterval(updateDashboard, 5000);
updateDashboard();
</script>

</body>
</html>
