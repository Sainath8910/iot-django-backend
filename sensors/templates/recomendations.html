<!DOCTYPE html>
<html class="dark">
<head>
  <title>AgriPulse AI – Crop Recommendation</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">

  <style>
    body { font-family: Manrope, sans-serif; }
  </style>
</head>

<body class="bg-[#152111] text-white">

<div class="max-w-7xl mx-auto p-6 lg:p-10 space-y-8">

  <!-- TOP BAR -->
  <div class="flex justify-between items-center">
    <button onclick="window.history.back()"
      class="flex items-center gap-2 bg-[#49e619] text-black px-4 py-2 rounded-full font-bold">
      <span class="material-symbols-outlined">arrow_back</span>
      Back
    </button>
  </div>

  <!-- SENSOR SUMMARY -->
  <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">

    <div class="sensor-card">
      <span class="material-symbols-outlined">thermostat</span>
      <p>Temperature</p>
      <h3 id="tempValue"></h3>
    </div>

    <div class="sensor-card">
      <span class="material-symbols-outlined">humidity_high</span>
      <p>Humidity</p>
      <h3 id="humidityValue"></h3>
    </div>

    <div class="sensor-card">
      <span class="material-symbols-outlined">potted_plant</span>
      <p>Soil Moisture</p>
      <h3 id="moistureValue"></h3>
    </div>

    <div class="sensor-card">
      <span class="material-symbols-outlined">science</span>
      <p>pH Level</p>
      <h3 id="phValue"></h3>
    </div>

    <div class="sensor-card">
      <span class="material-symbols-outlined">devices</span>
      <p>Device</p>
      <h3 id="deviceId" class="text-[#49e619]"></h3>
    </div>

    <div class="sensor-card">
      <span class="material-symbols-outlined">schedule</span>
      <p>Captured At</p>
      <h3 id="caseTime" class="text-sm"></h3>
    </div>

  </div>

  <!-- MAIN CONTENT -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">

    <!-- LEFT PANEL -->
    <div class="bg-white/5 border border-white/10 rounded-2xl p-6 space-y-6">

      <!-- IMAGE -->
      <div class="relative">
        <div id="leafImage"
             class="aspect-square rounded-xl bg-center bg-cover max-h-[380px]">
        </div>

        <!-- IMAGE TIMESTAMP -->
        <div id="imageTime"
             class="absolute bottom-3 right-3 bg-black/60 text-xs px-3 py-1 rounded-full hidden">
        </div>
      </div>

      <!-- STATUS -->
      <div class="grid grid-cols-2 gap-4">

        <div id="stressBox" class="status-card hidden">
          <p>Stress Level</p>
          <h4 id="stressValue"></h4>
        </div>

        <div id="timeBox" class="status-card hidden">
          <p>Timestamp</p>
          <h4 id="caseTime2"></h4>
        </div>

      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="bg-white/5 border border-white/10 rounded-2xl p-6 space-y-6">

      <div>
        <p id="cropName" class="uppercase text-sm tracking-wider text-[#49e619]"></p>
        <h2 id="diseaseName" class="text-3xl font-black mt-1"></h2>
      </div>

      <div id="reasonBox" class="hidden">
        <p class="section-label">Why this happened</p>
        <p id="aiReason" class="text-sm mt-1"></p>
      </div>

      <div id="treatmentBox" class="hidden">
        <p class="section-label">What to do</p>
        <ul id="aiTreatment" class="list-disc list-inside text-sm mt-2"></ul>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4">

        <div id="fertilizerBox" class="recommend-card hidden">
          <p>Recommended Fertilizer</p>
          <h4 id="fertilizerName"></h4>
        </div>

        <div id="sprayBox" class="recommend-card hidden">
          <p>Recommended Spray</p>
          <h4 id="sprayName"></h4>
        </div>

      </div>
    </div>
  </div>

</div>

<!-- STYLES -->
<style>
.sensor-card {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 14px;
  padding: 14px;
  text-align: center;
}
.sensor-card span {
  font-size: 20px;
  color: #49e619;
}
.sensor-card p {
  font-size: 11px;
  color: rgba(255,255,255,0.4);
}
.sensor-card h3 {
  font-size: 16px;
  font-weight: bold;
  margin-top: 4px;
}

.status-card {
  background: rgba(255,255,255,0.05);
  border-radius: 14px;
  padding: 14px;
}
.status-card p {
  font-size: 11px;
  color: rgba(255,255,255,0.4);
}
.status-card h4 {
  font-size: 16px;
  font-weight: bold;
}

.section-label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: rgba(255,255,255,0.4);
}

.recommend-card {
  background: rgba(73,230,25,0.1);
  border-radius: 14px;
  padding: 16px;
}
.recommend-card p {
  font-size: 11px;
  color: #49e619;
  text-transform: uppercase;
}
.recommend-card h4 {
  font-size: 15px;
  font-weight: bold;
  margin-top: 4px;
}
</style>

<!-- SCRIPT -->
<script>
const id = new URLSearchParams(window.location.search).get("reading");

fetch(`/case/${id}/`)
.then(res => res.json())
.then(d => {

  if (d.image) {
    document.getElementById("leafImage").style.backgroundImage = `url('${d.image}')`;
    document.getElementById("imageTime").textContent = d.time;
    document.getElementById("imageTime").classList.remove("hidden");
  }

  d.crop && (cropName.textContent = d.crop);
  d.disease && (diseaseName.textContent = d.disease);

  d.temperature && (tempValue.textContent = d.temperature + "°C");
  d.humidity && (humidityValue.textContent = d.humidity + "%");
  d.soil_moisture && (moistureValue.textContent = d.soil_moisture + "%");
  d.ph && (phValue.textContent = d.ph);
  d.device && (deviceId.textContent = d.device);
  d.time && (caseTime.textContent = d.time);

  if (d.stress) {
    stressValue.textContent = d.stress;
    stressBox.classList.remove("hidden");
    caseTime2.textContent = d.time;
    timeBox.classList.remove("hidden");
  }

  if (d.recommendation?.reason) {
    aiReason.textContent = d.recommendation.reason;
    reasonBox.classList.remove("hidden");
  }

  if (d.recommendation?.treatment) {
    aiTreatment.innerHTML = "";
    d.recommendation.treatment.split(".").forEach(t => {
      if (t.trim()) aiTreatment.innerHTML += `<li>${t}</li>`;
    });
    treatmentBox.classList.remove("hidden");
  }

  if (d.recommendation?.fertilizer) {
    fertilizerName.textContent = d.recommendation.fertilizer;
    fertilizerBox.classList.remove("hidden");
  }

  if (d.recommendation?.spray) {
    sprayName.textContent = d.recommendation.spray;
    sprayBox.classList.remove("hidden");
  }
});
</script>

</body>
</html>
